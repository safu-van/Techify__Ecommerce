{% extends 'user/base.html' %}
{% load static %}
{% block title %}Products{% endblock %}
{% block css %}
<link rel="stylesheet" href="{% static 'user/assets/vendor/line-awesome/line-awesome/line-awesome/css/line-awesome.min.css' %}">
<link rel="stylesheet" href="{% static 'user/assets/css/bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'user/assets/css/plugins/owl-carousel/owl.carousel.css' %}">
<link rel="stylesheet" href="{% static 'user/assets/css/plugins/magnific-popup/magnific-popup.css' %}">
<link rel="stylesheet" href="{% static 'user/assets/css/plugins/jquery.countdown.css' %}">
<link rel="stylesheet" href="{% static 'user/assets/css/style.css' %}">
<link rel="stylesheet" href="{% static 'user/assets/css/skins/skin-demo-13.css' %}">
<link rel="stylesheet" href="{% static 'user/assets/css/demos/demo-13.css' %}">
{% endblock %}
{% block main %}
<main class="main">
   <div class="page-content">
      <div class="container">
         <div class="toolbox">
            <div class="toolbox-left">
               <a href="#" class="sidebar-toggler"><i class="icon-bars"></i>Filters</a>
            </div>
            <div class="toolbox-right">
               <form method="POST" action="{% url 'product:product_list' %}">
                  {% csrf_token %}
                  <div class="toolbox-sort">
                     <label for="sortby">Sort by:</label>
                     <div class="select-custom">
                        <select name="sortby" id="sortby" class="form-control" onchange="this.form.submit()">
                           <option value="" selected disabled>Select an Option</option>
                           <option value="Price: low to high">Price: low to high</option>
                           <option value="Price: high to low">Price: high to low</option>
                           <option value="New Arrivals">New Arrivals</option>
                        </select>
                     </div>
                  </div>
               </form>
            </div>
         </div>
         <div class="products" >
            <div class="row" >
               {% for product in products %}
               <div class="col-6 col-md-4 col-lg-4 col-xl-3">
                  <div class="product">
                     <figure class="product-media">
                        {% if product.offer is not null %}
                        <span class="product-label label-sale">{{ product.offer.offer_percentage }}% off</span>
                        {% endif %}
                        <a href="{% url 'product:product_view' product.id %}">
                        <img src="{{ product.thumbnail.url }}" alt="Product image" class="product-image">
                        </a>
                        <div class="product-action-vertical">
                           <a href="#" class="btn-product-icon btn-wishlist btn-expandable"><span>add to wishlist</span></a>
                        </div>
                     </figure>
                     <div class="product-body">
                        <div class="product-cat">
                           <a href="{% url 'product:category_product' product.category.id%}">{{ product.category.name }}</a>
                        </div>
                        <h3 class="product-title"><a href="{% url 'product:product_view' product.id %}">{{ product.name }}</a></h3>
                        <div class="product-price">
                           <span class="new-price">${{ product.price }}</span>
                           <span class="old-price">Was <s>$290.00</s></span>
                        </div>
                        <div class="ratings-container">
                           <div class="ratings">
                              <div class="ratings-val" style="width: 100%;"></div>
                           </div>
                           <span class="ratings-text">( 2 )</span>
                           {% if product.stock == 0 %}
                           <span class="product-label label-sale" style="top: 101px; padding: 0px; background: #fff; color: #d30000;">Out of Stock</span>
                           {% elif product.stock <= 5 %}
                           <span class="product-label label-sale" style="top: 101px; padding: 0px; background: #fff; color: #d30000;">( Only {{ product.stock }} left in stock )</span>
                           {% endif %}
                        </div>
                     </div>
                  </div>
               </div>
               {% endfor %}
            </div>
            {% if not products %}
            <div style="text-align: center; margin-top: 20rem; height: 50rem;">
               <h2>Empty</h2>
               <span>Sorry, The Product is not Available</span>
            </div>
            {% endif %}
         </div>
         <div class="sidebar-filter-overlay"></div>
         <aside class="sidebar-shop sidebar-filter">
            <form id="filter-form" method="post" action="{% url 'product:filtered_products' %}" onsubmit="return validateForm()">
               {% csrf_token %}
               <div class="sidebar-filter-wrapper">
                  <div class="widget widget-clean" style="margin-bottom: 1rem;">
                     <a href="{% url 'product:product_list' %}" >Clear All</a>
                  </div>
                  <div class="widget widget-collapsible" style="margin-bottom: 1rem;">
                     <h3 class="widget-title">
                        <a data-toggle="collapse" href="#widget-1" role="button" aria-expanded="true" aria-controls="widget-1">
                        Category
                        </a>
                     </h3>
                     {% for category in categories %}
                     <div class="collapse show" id="widget-1">
                        <div class="widget-body">
                           <div class="filter-items filter-items-count">
                              <div class="filter-item">
                                 <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="cat-{{ category.id }}" name="categories" value="{{ category.id }}"
                                    {% if category.id in selected_categories %} checked {% endif %}>
                                    <label class="custom-control-label" for="cat-{{ category.id }}">{{ category.name }}</label>
                                 </div>
                                 <span class="item-count">{{ category.product_count }}</span>
                              </div>
                           </div>
                        </div>
                     </div>
                     {% endfor %}
                  </div>
                  <div class="widget widget-collapsible" style="margin-bottom: 1rem;">
                     <h3 class="widget-title">
                        <a data-toggle="collapse" href="#widget-4" role="button" aria-expanded="true" aria-controls="widget-4">
                        Brand
                        </a>
                     </h3>
                     {% for brand in brands %}
                     <div class="collapse show" id="widget-4">
                        <div class="widget-body">
                           <div class="filter-items filter-items-count">
                              <div class="filter-item">
                                 <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="brand-{{ brand.id }}" name="brands" value="{{ brand.id }}"
                                    {% if brand.id in selected_brands %} checked {% endif %}>
                                    <label class="custom-control-label" for="brand-{{ brand.id }}">{{ brand.name }}</label>
                                 </div>
                                 <span class="item-count">{{ brand.product_count }}</span>
                              </div>
                           </div>
                        </div>
                     </div>
                     {% endfor %}
                  </div>
               </div>
               <span id="filterError" style="color: red; font-size: 12px; display: flex; justify-content: center;"></span>   
               <div style="display: flex; justify-content: center;">
                  <button style="border: none; background: white;">
                  <a class="btn btn-primary text-white rounded-pill">APPLY FILTERS</a>
                  </button>
               </div>
            </form>
         </aside>
      </div>
   </div>
</main>
{% endblock %}
{% block mobile_menu %}
<div class="mobile-menu-overlay"></div>
<div class="mobile-menu-container">
   <div class="mobile-menu-wrapper">
      <span class="mobile-menu-close"><i class="icon-close"></i></span>
      <nav class="mobile-nav">
         <ul class="mobile-menu">
            <li class="active">
               <a href="#">Home</a>
            </li>
            <li>
               <a href="#">Shop</a>
            </li>
            <li>
               <a href="#" class="sf-with-ul">Product</a>
            </li>
            <li>
               <a href="#">Pages</a>
            </li>
            <li>
               <a href="#">Blog</a>    
            </li>
         </ul>
      </nav>
      <div class="social-icons">
         <a href="#" class="social-icon" target="_blank" title="Facebook"><i class="icon-facebook-f"></i></a>
         <a href="#" class="social-icon" target="_blank" title="Twitter"><i class="icon-twitter"></i></a>
         <a href="#" class="social-icon" target="_blank" title="Instagram"><i class="icon-instagram"></i></a>
         <a href="#" class="social-icon" target="_blank" title="Youtube"><i class="icon-youtube"></i></a>
      </div>
   </div>
</div>
{% endblock %}
{% block js %}
<script src="{% static 'user/assets/js/jquery.min.js' %}"></script>
<script src="{% static 'user/assets/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'user/assets/js/jquery.hoverIntent.min.js' %}"></script>
<script src="{% static 'user/assets/js/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'user/assets/js/superfish.min.js' %}"></script>
<script src="{% static 'user/assets/js/owl.carousel.min.js' %}"></script>
<script src="{% static 'user/assets/js/wNumb.js' %}"></script>
<script src="{% static 'user/assets/js/bootstrap-input-spinner.js' %}"></script>
<script src="{% static 'user/assets/js/jquery.magnific-popup.min.js' %}"></script>
<script src="{% static 'user/assets/js/nouislider.min.js' %}"></script>
<script src="{% static 'user/assets/js/main.js' %}"></script>
{% endblock %}
{% block extra_js %}
<script>
   function validateForm() {
      var categoriesChecked = document.querySelectorAll('input[name="categories"]:checked');
      var brandsChecked = document.querySelectorAll('input[name="brands"]:checked');
      var filterError = document.getElementById('filterError')
   
      filterError.innerHTML = "";
   
      if (categoriesChecked.length === 0 && brandsChecked.length === 0) {
          filterError.innerHTML = "Please select atleast one option to filter.";
          return false;
      }
   
      return true;
   }
   document.addEventListener("DOMContentLoaded", function() {
       var currentUrl = window.location.href;
       var menuLinks = document.querySelectorAll(".main-nav .menu li a");
   
       menuLinks.forEach(function(link) {
           if (link.href === currentUrl) {
               link.parentElement.classList.add("active");
           }
       });
   });
</script>
{% endblock %}